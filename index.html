<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Timecard</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  padding: 15px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  text-align: center;
  border: 1px solid #ccc;
}

input {
  width: 100%;
  padding: 6px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 6px;
  background: #fff;
  box-sizing: border-box;
}

input[type="date"],
input[type="time"] {
  -webkit-appearance: none;
  appearance: none;
}

button {
  margin-top: 12px;
  padding: 10px;
  width: 100%;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #007aff;
  color: white;
}

.total {
  font-weight: bold;
}

  .today-row {
  background-color: #e6f9ec;
  border-left: 5px solid #28a745;
}

h2 {
  margin-bottom: 15px;
}
</style>

</head>
<body>

<h2>Timecard</h2>

  <label for="payRate"><strong>Pay Rate:</strong></label>
<select id="payRate" onchange="calculate()" style="margin-bottom:15px; padding:6px; font-size:16px;">
  <option value="7.60">£7.60</option>
  <option value="10.05">£10.05</option>
  <option value="12.25" selected>£12.25</option>
  <option value="12.82">£12.82</option>
</select>

  <div style="margin-bottom:20px;">
  <button onclick="setView('week')">Week View</button>
  <button onclick="setView('month')">28-Day View</button>

  <div id="weekControls" style="margin-top:10px;">
    <button id="prevWeek" onclick="changeWeek(-1)">◀</button>
    <span id="weekLabel"></span>
    <button id="nextWeek" onclick="changeWeek(1)">▶</button>
  </div>

  <h3 id="cycleRange"></h3>
</div>

<table border="1">
<thead>
<tr>
<th>Date</th>
<th>Clock In</th>
<th>Clock Out</th>
<th>Break (hrs)</th>
<th>Total Hours</th>
</tr>
</thead>
<tbody id="rows">
</tbody>
</table>

<h3>Total Week Hours: <span id="weekTotal">0.00</span></h3>
<h3>Total Money: £<span id="totalMoney">0.00</span></h3>

<script>
const anchorDate = new Date(2026, 1, 2); // Feb 2 2026
let currentView = "week";
let currentWeek = 1;
let cycleStartDate;

function getCurrentCycle() {
  const today = new Date();
  const diffDays = Math.floor((today - anchorDate) / 86400000);
  const cycleIndex = Math.floor(diffDays / 28);

  cycleStartDate = new Date(anchorDate);
  cycleStartDate.setDate(anchorDate.getDate() + cycleIndex * 28);

  const cycleEnd = new Date(cycleStartDate);
  cycleEnd.setDate(cycleStartDate.getDate() + 27);

  document.getElementById("cycleRange").innerText =
    `Cycle: ${cycleStartDate.toLocaleDateString("en-GB")} - ${cycleEnd.toLocaleDateString("en-GB")}`;
}

function formatDate(date) {
  return date.toLocaleDateString("en-GB", {
    day: "2-digit",
    month: "2-digit",
    year: "numeric"
  });
}

function addRow(dateObj) {
  const tbody = document.getElementById("rows");
  const row = document.createElement("tr");

  const today = new Date();
  const isToday =
    dateObj.getDate() === today.getDate() &&
    dateObj.getMonth() === today.getMonth() &&
    dateObj.getFullYear() === today.getFullYear();

  if (isToday) {
    row.classList.add("today-row");
    setTimeout(() => {
      row.querySelector(".in").focus();
    }, 100);
  }

  row.innerHTML = `
    <td>${formatDate(dateObj)}</td>
    <td><input type="time" class="in"></td>
    <td><input type="time" class="out"></td>
    <td><input type="number" step="0.01" class="break" value="0"></td>
    <td class="total">0.00</td>
  `;

  tbody.appendChild(row);

  row.querySelectorAll("input").forEach(input => {
    input.addEventListener("input", calculate);
  });
}

function renderDates() {
  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  let daysToShow = currentView === "month" ? 28 : 7;
  let startOffset = currentView === "month" ? 0 : (currentWeek - 1) * 7;

  for (let i = 0; i < daysToShow; i++) {
    const date = new Date(cycleStartDate);
    date.setDate(cycleStartDate.getDate() + startOffset + i);
    addRow(date);
  }

  updateWeekControls();
  calculate();
}

function setView(view) {
  currentView = view;
  currentWeek = 1;
  renderDates();
}

function changeWeek(direction) {
  currentWeek += direction;
  if (currentWeek < 1) currentWeek = 1;
  if (currentWeek > 4) currentWeek = 4;
  renderDates();
}

function updateWeekControls() {
  const prev = document.getElementById("prevWeek");
  const next = document.getElementById("nextWeek");

  if (currentView === "month") {
    document.getElementById("weekControls").style.display = "none";
    return;
  }

  document.getElementById("weekControls").style.display = "block";
  document.getElementById("weekLabel").innerText = `Week ${currentWeek}`;

  prev.disabled = currentWeek === 1;
  next.disabled = currentWeek === 4;
}

function calculate() {
  let totalHours = 0;

  document.querySelectorAll("#rows tr").forEach(row => {
    const timeIn = row.querySelector(".in").value;
    const timeOut = row.querySelector(".out").value;
    const breakHours = parseFloat(row.querySelector(".break").value) || 0;

    if (timeIn && timeOut) {
      const inDate = new Date(`1970-01-01T${timeIn}:00`);
      const outDate = new Date(`1970-01-01T${timeOut}:00`);

      let diff = (outDate - inDate) / 1000 / 60 / 60;
      if (diff < 0) diff += 24;

      diff -= breakHours;
      if (diff < 0) diff = 0;

      row.querySelector(".total").innerText = diff.toFixed(2);
      totalHours += diff;
    } else {
      row.querySelector(".total").innerText = "0.00";
    }
  });

  document.getElementById("weekTotal").innerText = totalHours.toFixed(2);

  const selectedRate = parseFloat(document.getElementById("payRate").value);
  const totalMoney = totalHours * selectedRate;
  document.getElementById("totalMoney").innerText = totalMoney.toFixed(2);
}

getCurrentCycle();
renderDates();
</script>

</body>
</html>
